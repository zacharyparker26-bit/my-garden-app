<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Balcony Garden Manager</title>
    
    <!-- MOBILE APP CONFIGURATION -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1e293b">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/628/628283.png">
    
    <!-- EMBEDDED MANIFEST -->
    <link rel="manifest" href="data:application/manifest+json;base64,eyJuYW1lIjoiQmFsY29ueSBHYXJkZW4iLCJzaG9ydF9uYW1lIjoiR2FyZGVuIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiIzJmM2UzMCIsInRoZW1lX2NvbG9yIjoiIzJmM2UzMCIsImljb25zIjpbeyJzcmMiOiJodHRwczovL2Nkbi1pY29ucy1wbmcuZmxhdGljb24uY29tLzUxMi82MjgvNjI4MjgzLnBuZyIsInNpemVzIjoiMTkyeDE5MiIsInR5cGUiOiJpbWFnZS9wbmcifV19">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=VT323&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        :root {
            --bg-color: #1e293b; /* Dark slate */
            --card-bg: #fdfbf7; 
            --accent-wood: #78350f;
        }
        body {
            background-color: var(--bg-color);
            font-family: 'Nunito', sans-serif;
            color: #e2e8f0;
            overscroll-behavior-y: none;
        }
        
        h1, h2, h3, .pixel-font {
            font-family: 'VT323', monospace;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .card-shadow {
            box-shadow: 4px 4px 0px rgba(0, 0, 0, 0.3);
            border-bottom: 3px solid #0f172a;
            border-right: 3px solid #0f172a;
        }
        
        .wood-btn {
            background-color: #92400e;
            border: 2px solid #451a03;
            border-bottom-width: 4px;
            color: #fef3c7;
            text-shadow: 1px 1px 0 #451a03;
        }
        .wood-btn:hover { background-color: #b45309; }
        .wood-btn:active {
            transform: translateY(2px);
            border-bottom-width: 2px;
        }

        /* Custom scrollbar */
        .library-scroll::-webkit-scrollbar { width: 4px; height: 4px; }
        .library-scroll::-webkit-scrollbar-track { background: #334155; }
        .library-scroll::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 2px; }
        
        /* Animations */
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        @keyframes twinkle { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }
        @keyframes drift { from { transform: translateX(-10%); } to { transform: translateX(110%); } }
        @keyframes growUp { 0% { transform: scaleY(0); opacity: 0; } 100% { transform: scaleY(1); opacity: 1; } }
        @keyframes popIn { 0% { transform: scale(0); opacity: 0; } 80% { transform: scale(1.2); opacity: 1; } 100% { transform: scale(1); opacity: 1; } }
        
        .animate-float { animation: float 3s ease-in-out infinite; }
        .animate-twinkle { animation: twinkle 2s ease-in-out infinite; }
        .animate-drift { animation: drift 60s linear infinite; }
        .animate-grow { transform-origin: bottom center; animation: growUp 0.8s ease-out forwards; }
        .animate-pop { animation: popIn 0.5s ease-out forwards; }
        
        .pixel-art { image-rendering: pixelated; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- CONSTANTS ---
        const POT_OPTIONS = [
            { label: "Standard Plastic (Medium)", waterMod: 1.0, fertMod: 1.0 },
            { label: "Small Clay/Terracotta", waterMod: 0.6, fertMod: 0.8 }, 
            { label: "Large Plastic (5+ Gal)", waterMod: 1.3, fertMod: 1.1 }, 
            { label: "Grow Bag (Fabric)", waterMod: 0.7, fertMod: 0.8 }, 
            { label: "Hanging Basket", waterMod: 0.5, fertMod: 0.9 }, 
            { label: "Self-Watering Container", waterMod: 1.8, fertMod: 1.2 }, 
            { label: "Window Box (Shallow)", waterMod: 0.8, fertMod: 1.0 },
            { label: "Ceramic / Glazed", waterMod: 1.1, fertMod: 1.0 }
        ];

        const CONTAINER_SIZES = [
            { label: "Small (< 1 Gal)", waterMod: 0.6, fertMod: 0.9 },
            { label: "1 Gallon", waterMod: 0.7, fertMod: 0.9 },
            { label: "2 Gallon", waterMod: 0.85, fertMod: 0.95 },
            { label: "3 Gallon", waterMod: 1.0, fertMod: 1.0 },
            { label: "4 Gallon", waterMod: 1.1, fertMod: 1.0 },
            { label: "5 Gallon", waterMod: 1.2, fertMod: 1.05 },
            { label: "6 Gallon", waterMod: 1.25, fertMod: 1.05 },
            { label: "7 Gallon", waterMod: 1.3, fertMod: 1.1 },
            { label: "8 Gallon", waterMod: 1.35, fertMod: 1.1 },
            { label: "9 Gallon", waterMod: 1.4, fertMod: 1.15 },
            { label: "10 Gallon", waterMod: 1.5, fertMod: 1.2 }
        ];

        const PLANT_LIBRARY = [
            { name: "Basil (Genovese)", type: "herb", waterFreq: 3, fertilizerFreq: 14, notes: "Classic Italian basil.", tip: "Harvest often to prevent flowering." },
            { name: "Basil (Thai)", type: "herb", waterFreq: 3, fertilizerFreq: 14, notes: "Spicier flavor.", tip: "Great for high heat areas." },
            { name: "Chives", type: "grass", waterFreq: 4, fertilizerFreq: 30, notes: "Hardy perennial.", tip: "Divide clumps every 2-3 years." },
            { name: "Cilantro", type: "herb", waterFreq: 3, fertilizerFreq: 14, notes: "Bolts in heat.", tip: "Use roots for cooking too!" },
            { name: "Kale (Lacinato)", type: "leafy", waterFreq: 3, fertilizerFreq: 14, notes: "Dino kale.", tip: "Frost makes leaves sweeter." },
            { name: "Lettuce (Leaf)", type: "leafy", waterFreq: 2, fertilizerFreq: 14, notes: "Shallow roots.", tip: "Harvest 'cut and come again'." },
            { name: "Mint (Chocolate)", type: "herb", waterFreq: 2, fertilizerFreq: 30, notes: "Peppermint scent.", tip: "Keep in a pot! Invasive." },
            { name: "Mint (Mojito)", type: "herb", waterFreq: 2, fertilizerFreq: 30, notes: "Invasive roots! Keep separate.", tip: "Re-pot annually." },
            { name: "Oregano", type: "herb", waterFreq: 5, fertilizerFreq: 30, notes: "Drought tolerant.", tip: "Best flavor just before flowering." },
            { name: "Parsley", type: "herb", waterFreq: 3, fertilizerFreq: 21, notes: "Biennial.", tip: "Taproot needs deep pot." },
            { name: "Rosemary", type: "bush", waterFreq: 7, fertilizerFreq: 0, notes: "Hates wet feet.", tip: "Never overwater." },
            { name: "Spinach", type: "leafy", waterFreq: 2, fertilizerFreq: 14, notes: "Cold weather crop.", tip: "Bolts in heat." },
            { name: "Thyme", type: "herb", waterFreq: 5, fertilizerFreq: 0, notes: "Low maintenance.", tip: "Trimming encourages growth." },
            { name: "Pepper (Aji Dulce)", type: "pepper", waterFreq: 3, fertilizerFreq: 14, notes: "Sweet habanero.", tip: "Slow starter, be patient." },
            { name: "Pepper (Bell)", type: "pepper", waterFreq: 3, fertilizerFreq: 14, notes: "Heavy feeder.", tip: "Needs calcium." },
            { name: "Pepper (Jalapeno)", type: "pepper", waterFreq: 4, fertilizerFreq: 14, notes: "Mild heat.", tip: "Less water = hotter peppers." },
            { name: "Pepper (Purple Jalapeno)", type: "pepper", waterFreq: 4, fertilizerFreq: 14, notes: "Dark purple fruit.", tip: "Visual ripeness indicator." },
            { name: "Pepper (Thai Chili)", type: "pepper", waterFreq: 3, fertilizerFreq: 14, notes: "Very hot.", tip: "Dry for spice flakes." },
            { name: "Tomato (Black Cherry)", type: "tomato", waterFreq: 1, fertilizerFreq: 14, notes: "Heirloom. Dark fruit.", tip: "Prune suckers to manage size." },
            { name: "Tomato (Black Trifle)", type: "tomato", waterFreq: 1, fertilizerFreq: 14, notes: "Pear shaped, smoky.", tip: "Harvest with green shoulders." },
            { name: "Tomato (Atomic Grape)", type: "tomato", waterFreq: 1, fertilizerFreq: 14, notes: "Multi-colored.", tip: "Wait for red/orange hues." },
            { name: "Tomato (Cherokee Purple)", type: "tomato", waterFreq: 1, fertilizerFreq: 14, notes: "Heirloom slicer.", tip: "Prone to cracking." },
            { name: "Tomato (Roma)", type: "tomato", waterFreq: 2, fertilizerFreq: 14, notes: "Determinate.", tip: "Don't prune heavily." },
            { name: "Tomato (Sun Gold)", type: "tomato", waterFreq: 1, fertilizerFreq: 14, notes: "Orange cherry.", tip: "Splits if overwatered." },
            { name: "Tomato (Tiny Tim)", type: "tomato", waterFreq: 2, fertilizerFreq: 14, notes: "Micro-dwarf.", tip: "Perfect for table-top." },
            { name: "Beans (Bush)", type: "bush", waterFreq: 3, fertilizerFreq: 21, notes: "Nitrogen fixer.", tip: "Don't add nitrogen." },
            { name: "Carrots", type: "root", waterFreq: 3, fertilizerFreq: 21, notes: "Loose soil needed.", tip: "Thin seedlings ruthlessly." },
            { name: "Cucumber", type: "vine", waterFreq: 1, fertilizerFreq: 14, notes: "Thirsty.", tip: "Watch for mildew." },
            { name: "Eggplant", type: "bush", waterFreq: 2, fertilizerFreq: 14, notes: "Loves heat.", tip: "Harvest while glossy." },
            { name: "Radishes", type: "root", waterFreq: 2, fertilizerFreq: 0, notes: "Fast crop.", tip: "Spicy in hot weather." },
            { name: "Strawberries", type: "berry", waterFreq: 2, fertilizerFreq: 14, notes: "Keep fruit off soil.", tip: "Remove runners." },
            { name: "Zucchini", type: "bush", waterFreq: 1, fertilizerFreq: 14, notes: "Heavy feeder.", tip: "Hand pollination helps." }
        ];

        const PALETTES = {
            healthy: { stem: '#4d7c0f', leafLight: '#4ade80', leafDark: '#15803d', fruit: '#dc2626', fruitAlt: '#eab308', root: '#ea580c' },
            dry: { stem: '#78350f', leafLight: '#a8a29e', leafDark: '#57534e', fruit: '#78350f', fruitAlt: '#92400e', root: '#9a3412' },
            hungry: { stem: '#84cc16', leafLight: '#fef08a', leafDark: '#eab308', fruit: '#ef4444', fruitAlt: '#facc15', root: '#f97316' }
        };

        // --- PIXEL ART COMPONENTS ---
        const PixelPot = ({ color = "#8B4513" }) => (
            <g><rect x="6" y="15" width="12" height="7" fill={color} /><rect x="5" y="13" width="14" height="2" fill="#5e2f0d" /><rect x="6" y="15" width="12" height="1" fill="#3f1d07" opacity="0.5"/></g>
        );

        const PixelTable = () => (
            <g>
                <rect x="2" y="18" width="2" height="6" fill="#3f2e18" />
                <rect x="20" y="18" width="2" height="6" fill="#3f2e18" />
                <rect x="0" y="18" width="24" height="3" fill="#5c401f" />
                <rect x="0" y="21" width="24" height="1" fill="#362411" opacity="0.5"/>
            </g>
        );

        const PixelTomato = ({ scale = 1, status = 'healthy', variety = 'standard' }) => {
            const c = PALETTES[status];
            let fruitColor = c.fruit;
            let fruitShape = 'round';
            if (status === 'healthy') {
                if (variety.includes('black cherry') || variety.includes('cherokee')) fruitColor = '#3f0c18'; 
                if (variety.includes('black trifle')) { fruitColor = '#4a0404'; fruitShape = 'pear'; }
                if (variety.includes('sun gold') || variety.includes('atomic')) fruitColor = '#f97316'; 
            }
            return (
                <svg viewBox="0 0 24 24" width={24*scale} height={24*scale} className="pixel-art">
                    <PixelTable />
                    <g transform="translate(0, -4)">
                        <PixelPot />
                        <rect x="8" y="4" width="1" height="10" fill="#a8a29e" />
                        <rect x="15" y="4" width="1" height="10" fill="#a8a29e" />
                        <rect x="8" y="7" width="8" height="1" fill="#a8a29e" />
                        <rect x="8" y="11" width="8" height="1" fill="#a8a29e" />
                        <rect x="11" y="5" width="2" height="9" fill={c.stem} />
                        <rect x="10" y="8" width="4" height="4" fill={c.leafDark} />
                        <rect x="9" y="6" width="3" height="2" fill={c.leafDark} />
                        {fruitShape === 'pear' ? (
                            <><rect x="10" y="5" width="2" height="3" fill={fruitColor} /><rect x="9" y="7" width="4" height="2" fill={fruitColor} /></>
                        ) : (
                            <><rect x="10" y="6" width="2" height="2" fill={fruitColor} /><rect x="13" y="9" width="2" height="2" fill={fruitColor} /><rect x="9" y="10" width="2" height="2" fill={fruitColor} /></>
                        )}
                    </g>
                </svg>
            );
        };

        const PixelPepper = ({ scale = 1, status = 'healthy' }) => {
            const c = PALETTES[status];
            return (
                <svg viewBox="0 0 24 24" width={24*scale} height={24*scale} className="pixel-art">
                    <PixelTable />
                    <g transform="translate(0, -4)">
                        <PixelPot />
                        <rect x="11" y="10" width="2" height="4" fill={c.stem} />
                        <rect x="8" y="6" width="8" height="6" fill={c.leafDark} />
                        <rect x="7" y="8" width="10" height="3" fill={c.leafDark} />
                        <rect x="9" y="8" width="2" height="3" fill={c.fruit} />
                        <rect x="13" y="7" width="2" height="3" fill={c.fruitAlt} />
                    </g>
                </svg>
            );
        };

        const PixelLeafy = ({ scale = 1, status = 'healthy' }) => {
            const c = PALETTES[status];
            return (
                <svg viewBox="0 0 24 24" width={24*scale} height={24*scale} className="pixel-art">
                    <PixelTable />
                    <g transform="translate(0, -4)">
                        <PixelPot />
                        <rect x="11" y="11" width="2" height="3" fill={c.stem} />
                        <rect x="7" y="9" width="10" height="4" fill={c.leafDark} />
                        <rect x="8" y="7" width="8" height="4" fill={c.leafDark} />
                        <rect x="6" y="10" width="12" height="2" fill={c.leafDark} />
                    </g>
                </svg>
            );
        };

        const PixelRoot = ({ scale = 1, status = 'healthy' }) => {
            const c = PALETTES[status];
            return (
                <svg viewBox="0 0 24 24" width={24*scale} height={24*scale} className="pixel-art">
                    <PixelTable />
                    <g transform="translate(0, -4)">
                        <PixelPot color="#78350f" />
                        <rect x="11" y="9" width="2" height="4" fill={c.stem} />
                        <rect x="9" y="6" width="6" height="3" fill={c.leafDark} />
                        <rect x="11" y="13" width="2" height="2" fill={c.root} />
                        <rect x="10" y="14" width="4" height="2" fill={c.root} />
                    </g>
                </svg>
            );
        };

        const PixelHerb = ({ scale = 1, status = 'healthy' }) => {
            const c = PALETTES[status];
            return (
                <svg viewBox="0 0 24 24" width={24*scale} height={24*scale} className="pixel-art">
                    <PixelTable />
                    <g transform="translate(0, -4)">
                        <PixelPot color="#57534e" />
                        <rect x="11" y="11" width="2" height="3" fill={c.stem} />
                        <rect x="8" y="6" width="8" height="7" fill={c.leafDark} />
                        <rect x="7" y="8" width="10" height="4" fill={c.leafDark} />
                        <rect x="9" y="5" width="6" height="2" fill={c.leafLight} />
                    </g>
                </svg>
            );
        };

        const PixelGeneric = ({ scale = 1, status = 'healthy' }) => {
            const c = PALETTES[status];
            return (
                <svg viewBox="0 0 24 24" width={24*scale} height={24*scale} className="pixel-art">
                    <PixelTable />
                    <g transform="translate(0, -4)">
                        <PixelPot />
                        <rect x="11" y="8" width="2" height="6" fill={c.stem} />
                        <rect x="9" y="6" width="6" height="4" fill={c.leafDark} />
                        <rect x="8" y="8" width="8" height="4" fill={c.leafDark} />
                    </g>
                </svg>
            );
        };

        const getPlantVisual = (name, scale=1, status='healthy') => {
            const lowerName = name.toLowerCase();
            if (lowerName.includes('tomato')) return <PixelTomato scale={scale} status={status} variety={lowerName} />;
            if (lowerName.includes('pepper') || lowerName.includes('chili')) return <PixelPepper scale={scale} status={status} />;
            if (lowerName.includes('lettuce') || lowerName.includes('kale') || lowerName.includes('spinach') || lowerName.includes('chard')) return <PixelLeafy scale={scale} status={status} />;
            if (lowerName.includes('carrot') || lowerName.includes('radish') || lowerName.includes('beet')) return <PixelRoot scale={scale} status={status} />;
            if (lowerName.includes('basil') || lowerName.includes('mint') || lowerName.includes('thyme') || lowerName.includes('oregano') || lowerName.includes('parsley')) return <PixelHerb scale={scale} status={status} />;
            return <PixelGeneric scale={scale} status={status} />;
        };

        // --- ICONS ---
        const IconBase = ({ children, className = "", size = 24, color = "currentColor" }) => (<svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>);
        const Sun = (p) => <IconBase {...p}><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41-1.41"/><path d="m19.07 4.93-1.41 1.41"/></IconBase>;
        const Moon = (p) => <IconBase {...p}><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></IconBase>;
        const Plus = (p) => <IconBase {...p}><path d="M5 12h14"/><path d="M12 5v14"/></IconBase>;
        const Trash2 = (p) => <IconBase {...p}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></IconBase>;
        const Edit3 = (p) => <IconBase {...p}><path d="M12 20h9"/><path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z"/></IconBase>;
        const Droplets = (p) => <IconBase {...p}><path d="M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.8-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z"/><path d="M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.35"/></IconBase>;
        const Utensils = (p) => <IconBase {...p}><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/></IconBase>;
        const Save = (p) => <IconBase {...p}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></IconBase>;
        const X = (p) => <IconBase {...p}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></IconBase>;
        const Box = (p) => <IconBase {...p}><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22.08V12"/></IconBase>;
        const Search = (p) => <IconBase {...p}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></IconBase>;
        const CloudRain = (p) => <IconBase {...p}><line x1="16" y1="13" x2="16" y2="21"/><line x1="8" y1="13" x2="8" y2="21"/><line x1="12" y1="15" x2="12" y2="23"/><path d="M20 16.58A5 5 0 0 0 18 7h-1.26A8 8 0 1 0 4 15.25"/></IconBase>;
        const Thermometer = (p) => <IconBase {...p}><path d="M14 14.76V3.5a2.5 2.5 0 0 0-5 0v11.26a4.5 4.5 0 1 0 5 0z"/></IconBase>;
        const MapPin = (p) => <IconBase {...p}><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></IconBase>;
        const AlertTriangle = (p) => <IconBase {...p}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></IconBase>;
        const BookOpen = (p) => <IconBase {...p}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></IconBase>;
        const Download = (p) => <IconBase {...p}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></IconBase>;
        const Upload = (p) => <IconBase {...p}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></IconBase>;

        // --- ANIMATION ---
        const CelebrationOverlay = ({ plantName }) => (
            <div className="fixed inset-0 z-50 flex items-center justify-center pointer-events-none bg-black/40 backdrop-blur-sm transition-opacity duration-500">
                <div className="relative flex flex-col items-center">
                    <div className="animate-grow origin-bottom scale-150 mb-6 drop-shadow-2xl">
                        {getPlantVisual(plantName, 8, 'healthy')}
                    </div>
                    <div className="animate-pop text-center">
                        <span className="text-3xl font-bold text-[#fef3c7] bg-[#451a03] px-8 py-3 rounded-lg shadow-xl border-4 border-[#78350f] pixel-font tracking-widest">PLANTED!</span>
                    </div>
                </div>
            </div>
        );

        // --- APP LOGIC ---
        const App = () => {
            const [plants, setPlants] = useState([]);
            const [showModal, setShowModal] = useState(false);
            const [filter, setFilter] = useState('all'); 
            const [searchTerm, setSearchTerm] = useState('');
            const [justAddedPlant, setJustAddedPlant] = useState(null);
            
            const [weather, setWeather] = useState(null);
            const [weatherLoading, setWeatherLoading] = useState(false);
            const [weatherError, setWeatherError] = useState(null);
            const [savedCoords, setSavedCoords] = useState(null);
            
            const fileInputRef = useRef(null);
            
            const [newPlant, setNewPlant] = useState({
                id: null, name: '', nickname: '', location: '', 
                containerMaterial: 'Plastic', containerSize: '3 Gallon', 
                plantedDate: new Date().toISOString().split('T')[0],
                waterFreq: 3, lastWatered: new Date().toISOString().split('T')[0],
                fertilizerFreq: 14, lastFertilized: new Date().toISOString().split('T')[0],
                notes: ''
            });

            // LOAD DATA
            useEffect(() => { 
                try { 
                    const saved = localStorage.getItem('balconyTracker_v9'); 
                    if (saved) {
                        const parsed = JSON.parse(saved);
                        const migrated = parsed.map(p => {
                            if (!p.containerMaterial) {
                                return { ...p, containerMaterial: 'Plastic', containerSize: '3 Gallon' };
                            }
                            return p;
                        });
                        setPlants(migrated);
                    }
                    const coords = localStorage.getItem('garden_coords');
                    if (coords) setSavedCoords(JSON.parse(coords));
                } catch (e) {} 
            }, []);

            // SAVE DATA
            useEffect(() => { try { localStorage.setItem('balconyTracker_v9', JSON.stringify(plants)); } catch (e) {} }, [plants]);

            // AUTO-FETCH WEATHER
            useEffect(() => {
                if (savedCoords) {
                    fetchWeather(savedCoords.latitude, savedCoords.longitude);
                }
            }, [savedCoords]);

            const fetchWeather = async (lat, lon) => {
                setWeatherLoading(true); setWeatherError(null);
                try {
                    const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,precipitation,is_day&daily=temperature_2m_max,temperature_2m_min,weathercode,precipitation_sum&temperature_unit=fahrenheit&timezone=auto`);
                    if(!response.ok) throw new Error("Weather failed");
                    setWeather(await response.json());
                } catch (err) { setWeatherError("Could not load weather"); } finally { setWeatherLoading(false); }
            };

            const requestLocation = () => {
                if (!navigator.geolocation) { setWeatherError("Geolocation not supported"); return; }
                setWeatherLoading(true); setWeatherError(null);
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const { latitude, longitude } = position.coords;
                        localStorage.setItem('garden_coords', JSON.stringify({ latitude, longitude }));
                        setSavedCoords({ latitude, longitude });
                    },
                    () => { setWeatherError("Location denied"); setWeatherLoading(false); }
                );
            };

            const getWeatherIcon = (code) => {
                if (code <= 1) return <Sun size={14} className="text-yellow-400"/>;
                if (code <= 3) return <Sun size={14} className="text-gray-400"/>;
                if (code <= 67) return <CloudRain size={14} className="text-blue-400"/>;
                return <AlertTriangle size={14} className="text-red-400"/>;
            };

            const getDayName = (isoDate) => {
                const d = new Date(isoDate);
                return d.toLocaleDateString('en-US', { weekday: 'short' });
            };

            // Smart Weather Schedule Modifier
            const getSmartScheduleModifier = () => {
                if (!weather) return { val: 1.0, msg: null };
                
                // Look at next 3 days
                const nextDaysMax = weather.daily.temperature_2m_max.slice(0, 3);
                const nextDaysRain = weather.daily.precipitation_sum.slice(0, 3);
                
                const avgMax = nextDaysMax.reduce((a, b) => a + b, 0) / nextDaysMax.length;
                const totalRain = nextDaysRain.reduce((a, b) => a + b, 0);

                if (totalRain > 0.5) return { val: 1.5, msg: 'rain' }; // Rain Delay (slower)
                if (avgMax > 85) return { val: 0.7, msg: 'heat' }; // Heat (faster)
                
                return { val: 1.0, msg: null };
            };

            const handleExport = () => {
                const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(plants));
                const downloadAnchorNode = document.createElement('a');
                downloadAnchorNode.setAttribute("href", dataStr);
                downloadAnchorNode.setAttribute("download", "garden_backup.json");
                document.body.appendChild(downloadAnchorNode); 
                downloadAnchorNode.click();
                downloadAnchorNode.remove();
            };

            const handleImportClick = () => { fileInputRef.current.click(); };

            const handleFileChange = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const importedData = JSON.parse(event.target.result);
                        if (Array.isArray(importedData)) {
                            if(confirm(`Found ${importedData.length} plants in backup. Overwrite?`)) {
                                setPlants(importedData);
                                alert("Success!");
                            }
                        } else { alert("Invalid file."); }
                    } catch (error) { alert("Error reading file."); }
                };
                reader.readAsText(file);
                e.target.value = null; 
            };

            const handleSavePlant = (e) => {
                e.preventDefault(); if (!newPlant.name) return;
                const plantToSave = { ...newPlant, id: newPlant.id || Date.now().toString() };
                if (newPlant.id) setPlants(plants.map(p => p.id === newPlant.id ? plantToSave : p));
                else { setPlants([...plants, plantToSave]); setJustAddedPlant(newPlant.name); setTimeout(() => setJustAddedPlant(null), 2500); }
                closeModal();
            };

            const handleDelete = (id) => { if(confirm("Remove this pot?")) setPlants(plants.filter(p => p.id !== id)); };

            const logAction = (id, type) => {
                const today = new Date().toISOString().split('T')[0];
                setPlants(plants.map(p => p.id === id ? (type === 'water' ? { ...p, lastWatered: today } : { ...p, lastFertilized: today }) : p));
            };

            const calculateFrequencies = (basePlant, materialLabel, sizeLabel) => {
                const mat = CONTAINER_MATERIALS.find(m => m.label === materialLabel) || CONTAINER_MATERIALS[0];
                const siz = CONTAINER_SIZES.find(s => s.label === sizeLabel) || CONTAINER_SIZES[3]; 
                const totalWaterMod = mat.waterMod * siz.waterMod;
                const totalFertMod = mat.fertMod * siz.fertMod;
                const waterFreq = Math.max(1, Math.round(basePlant.waterFreq * totalWaterMod));
                const fertFreq = basePlant.fertilizerFreq === 0 ? 0 : Math.max(7, Math.round(basePlant.fertilizerFreq * totalFertMod));
                return { waterFreq, fertFreq };
            };

            const selectFromLibrary = (libPlant) => {
                const { waterFreq, fertFreq } = calculateFrequencies(libPlant, newPlant.containerMaterial, newPlant.containerSize);
                setNewPlant(prev => ({ 
                    ...prev, name: libPlant.name, waterFreq, fertilizerFreq: fertFreq, notes: libPlant.notes 
                }));
                setSearchTerm('');
            };

            const handleContainerChange = (field, value) => {
                const updatedPlant = { ...newPlant, [field]: value };
                const libEntry = PLANT_LIBRARY.find(p => p.name === newPlant.name);
                if (libEntry) {
                    const { waterFreq, fertFreq } = calculateFrequencies(libEntry, updatedPlant.containerMaterial, updatedPlant.containerSize);
                    updatedPlant.waterFreq = waterFreq;
                    updatedPlant.fertilizerFreq = fertFreq;
                }
                setNewPlant(updatedPlant);
            };

            const openEdit = (plant) => { setNewPlant(plant); setSearchTerm(''); setShowModal(true); };
            const openNew = () => {
                setNewPlant({ 
                    id: null, name: '', nickname: '', location: '', 
                    containerMaterial: 'Plastic', containerSize: '3 Gallon',
                    plantedDate: new Date().toISOString().split('T')[0],
                    waterFreq: 3, lastWatered: new Date().toISOString().split('T')[0],
                    fertilizerFreq: 14, lastFertilized: new Date().toISOString().split('T')[0],
                    notes: ''
                });
                setSearchTerm(''); setShowModal(true);
            };
            const closeModal = () => setShowModal(false);

            const getStatus = (lastDate, freq) => {
                if (parseInt(freq) === 0) return { daysLeft: 999, isDue: false, weatherIcon: null };
                const wMod = getSmartScheduleModifier(); 
                const adjustedFreq = Math.max(1, Math.round(freq * wMod.val));
                const next = new Date(lastDate); 
                next.setDate(next.getDate() + adjustedFreq); 
                next.setHours(0,0,0,0);
                const today = new Date(); today.setHours(0,0,0,0);
                const daysLeft = Math.ceil((next - today) / (1000 * 60 * 60 * 24));
                
                let icon = null;
                if(wMod.msg === 'rain') icon = <CloudRain size={12} className="text-blue-400"/>;
                if(wMod.msg === 'heat') icon = <Sun size={12} className="text-orange-400 animate-pulse"/>;

                return { daysLeft, isDue: daysLeft <= 0, weatherIcon: icon };
            };

            const filteredPlants = plants.filter(p => filter === 'due' ? (getStatus(p.lastWatered, p.waterFreq).isDue || getStatus(p.lastFertilized, p.fertilizerFreq).isDue) : true);
            const librarySuggestions = searchTerm.length > 0 ? PLANT_LIBRARY.filter(p => p.name.toLowerCase().includes(searchTerm.toLowerCase())) : [];
            const uniqueWisdom = Array.from(new Set(plants.map(p => p.name))).map(name => { const l = PLANT_LIBRARY.find(i => i.name === name); return l ? { name: name, tip: l.tip } : null; }).filter(Boolean);

            const isDay = weather ? weather.current.is_day === 1 : true;

            return (
                <div className="min-h-screen pb-32">
                    {justAddedPlant && <CelebrationOverlay plantName={justAddedPlant} />}

                    {/* Header */}
                    <header className="bg-slate-900 text-slate-200 shadow-lg sticky top-0 z-10 border-b-4 border-slate-800">
                        <div className="max-w-4xl mx-auto px-4 py-3 flex justify-between items-center">
                            <div className="flex items-center gap-2">
                                <span className="text-3xl">ðŸŒ¿</span>
                                <div>
                                    <h1 className="text-2xl font-bold leading-none tracking-wide text-slate-300">BALCONY</h1>
                                    <h1 className="text-xl font-bold leading-none tracking-wide text-amber-500">GARDEN</h1>
                                </div>
                            </div>
                            
                            <div className="flex gap-2">
                                <button onClick={handleExport} className="bg-slate-800 text-slate-400 p-2 rounded-lg border border-slate-700 hover:text-white" title="Export Backup"><Download size={18} /></button>
                                <input type="file" ref={fileInputRef} onChange={handleFileChange} className="hidden" accept=".json" />
                                <button onClick={handleImportClick} className="bg-slate-800 text-slate-400 p-2 rounded-lg border border-slate-700 hover:text-white" title="Import Backup"><Upload size={18} /></button>
                                <button onClick={openNew} className="wood-btn px-4 py-2 rounded-lg font-bold shadow-md flex items-center gap-2 text-lg transition-transform pixel-font tracking-widest ml-2"><Plus size={18} /> ADD</button>
                            </div>
                        </div>

                        {/* Forecast */}
                        <div className="bg-slate-800 p-2 border-b border-slate-700">
                            <div className="max-w-4xl mx-auto">
                                {!weather ? (
                                    <button onClick={requestLocation} className="w-full text-xs text-slate-400 hover:text-white flex items-center justify-center gap-2 bg-slate-700 px-3 py-2 rounded-sm border border-slate-600 pixel-font">
                                        <MapPin size={14} /> ENABLE WEATHER FORECAST
                                    </button>
                                ) : (
                                    <div className="flex overflow-x-auto pb-1 gap-2">
                                        {/* Today */}
                                        <div className="flex flex-col items-center p-2 bg-slate-700 rounded-sm border border-slate-600 min-w-[70px]">
                                            <span className="text-[10px] text-slate-400 font-bold">NOW</span>
                                            <span className="text-xl font-bold text-amber-400 pixel-font">{Math.round(weather.current.temperature_2m)}Â°</span>
                                            {getWeatherIcon(weather.daily.weathercode[0])}
                                        </div>
                                        {/* Next 6 Days */}
                                        {weather.daily.time.slice(1).map((day, idx) => (
                                            <div key={idx} className="flex flex-col items-center p-1 min-w-[50px] border-r border-slate-700 last:border-0">
                                                <span className="text-[10px] text-slate-500 font-bold uppercase">{getDayName(day)}</span>
                                                <div className="my-1">{getWeatherIcon(weather.daily.weathercode[idx+1])}</div>
                                                <span className="text-xs text-slate-300 font-mono">{Math.round(weather.daily.temperature_2m_max[idx+1])}Â°</span>
                                                <span className="text-[10px] text-slate-500 font-mono">{Math.round(weather.daily.temperature_2m_min[idx+1])}Â°</span>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </div>
                    </header>

                    <div className="max-w-4xl mx-auto p-4 space-y-6">
                        
                        {/* HERO GARDEN - Day/Night Cycle */}
                        <div className={`rounded-xl card-shadow overflow-hidden border-4 border-[#451a03] relative min-h-[40vh] flex flex-col justify-end transition-colors duration-1000 ${isDay ? 'bg-gradient-to-b from-sky-400 via-sky-200 to-amber-100' : 'bg-gradient-to-b from-slate-900 via-indigo-950 to-purple-900'}`}>
                            
                            {/* Celestial Bodies */}
                            <div className="absolute top-6 right-6 transition-all duration-1000">
                                {isDay ? <Sun size={64} className="text-yellow-300 animate-spin-slow" /> : <Moon size={50} className="text-slate-200 drop-shadow-lg" />}
                            </div>

                            {/* Stars (Night Only) */}
                            {!isDay && (
                                <>
                                    <div className="absolute top-10 left-10 w-1 h-1 bg-white rounded-full animate-twinkle" style={{animationDelay: '0.2s'}}></div>
                                    <div className="absolute top-20 left-1/3 w-1 h-1 bg-white rounded-full animate-twinkle" style={{animationDelay: '0.5s'}}></div>
                                    <div className="absolute top-5 right-1/4 w-1 h-1 bg-white rounded-full animate-twinkle" style={{animationDelay: '1s'}}></div>
                                </>
                            )}

                            {/* Clouds (Day Only) */}
                            {isDay && (
                                <>
                                    <div className="absolute top-10 left-0 animate-drift opacity-80"><CloudRain size={40} className="text-white"/></div>
                                    <div className="absolute top-24 left-[-20%] animate-drift opacity-60" style={{animationDuration: '40s'}}><CloudRain size={30} className="text-white"/></div>
                                </>
                            )}

                            <div className="absolute top-6 left-0 right-0 text-center z-10">
                                <h3 className="text-[#78350f] font-bold pixel-font text-3xl mb-1 opacity-90 bg-[#f0ebe5]/90 mx-auto w-fit px-6 py-1 rounded-sm shadow-sm border-2 border-[#78350f]/20">MY PLOT</h3>
                            </div>
                            
                            <div className="pt-20 pb-0 px-4 relative z-10 w-full">
                                <div className="flex items-end justify-center h-48 gap-4 overflow-x-auto library-scroll pb-0">
                                    {plants.length === 0 && <span className="text-white/80 text-lg mb-16 pixel-font animate-pulse">Empty plot... plant something!</span>}
                                    {plants.map((plant, idx) => {
                                        const water = getStatus(plant.lastWatered, plant.waterFreq);
                                        const food = getStatus(plant.lastFertilized, plant.fertilizerFreq);
                                        let status = 'healthy';
                                        if (water.isDue) status = 'dry'; else if (food.isDue) status = 'hungry';
                                        return (
                                            <div key={idx} className="flex-shrink-0 w-24 flex flex-col items-center group relative cursor-help filter drop-shadow-xl transition-all duration-300 hover:scale-110">
                                                <div>{getPlantVisual(plant.name, 4, status)}</div>
                                                <div className="absolute bottom-full mb-4 hidden group-hover:block bg-slate-900 text-slate-100 text-sm px-3 py-1 rounded-sm border border-slate-700 whitespace-nowrap z-20 pixel-font shadow-lg">
                                                    {plant.nickname || plant.name}
                                                    {status === 'dry' && <span className="block text-red-400 text-xs">THIRSTY</span>}
                                                    {status === 'hungry' && <span className="block text-yellow-400 text-xs">HUNGRY</span>}
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                                <div className="h-16 bg-[#3f1d07] border-t-8 border-[#5e2f0d] w-full pattern-dots-sm text-[#291505] relative"></div>
                            </div>
                        </div>

                        {/* Smart Schedule Badge */}
                        {weather && (
                            <div className="flex justify-center">
                                <div className="bg-slate-800 text-slate-400 text-xs px-3 py-1 rounded-full border border-slate-700 flex items-center gap-2">
                                    <div className="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                                    SMART SCHEDULE ACTIVE
                                </div>
                            </div>
                        )}

                        {/* Filter Tabs */}
                        <div className="flex gap-2 bg-slate-800 p-1 rounded-lg border border-slate-700">
                            <button onClick={() => setFilter('all')} className={`flex-1 py-1.5 rounded-md text-sm font-bold transition-colors pixel-font tracking-wide ${filter === 'all' ? 'bg-slate-600 text-white border border-slate-500' : 'text-slate-400 hover:bg-slate-700'}`}>FULL GARDEN</button>
                            <button onClick={() => setFilter('due')} className={`flex-1 py-1.5 rounded-md text-sm font-bold transition-colors pixel-font tracking-wide ${filter === 'due' ? 'bg-amber-700 text-amber-100 border border-amber-600' : 'text-slate-400 hover:bg-slate-700'}`}>NEEDS CARE</button>
                        </div>

                        {/* Main List */}
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            {filteredPlants.length === 0 && <div className="col-span-full text-center py-12 text-slate-500"><Box size={48} className="mx-auto opacity-50 mb-2"/><p className="pixel-font text-xl">No pots found.</p></div>}
                            {filteredPlants.map(plant => {
                                const water = getStatus(plant.lastWatered, plant.waterFreq);
                                const food = getStatus(plant.lastFertilized, plant.fertilizerFreq);
                                let status = 'healthy';
                                if (water.isDue) status = 'dry'; else if (food.isDue) status = 'hungry';

                                return (
                                    <div key={plant.id} className="bg-[#fdfbf7] rounded-xl card-shadow overflow-hidden relative border-2 border-slate-300">
                                        <div className="absolute top-2 right-2 flex gap-1">
                                             <button onClick={() => openEdit(plant)} className="p-1.5 text-slate-400 hover:text-slate-600 rounded-sm hover:bg-slate-100"><Edit3 size={16} /></button>
                                             <button onClick={() => handleDelete(plant.id)} className="p-1.5 text-slate-400 hover:text-red-500 rounded-sm hover:bg-red-50"><Trash2 size={16} /></button>
                                        </div>
                                        <div className="p-4">
                                            <div className="flex gap-3 mb-4">
                                                <div className="shrink-0 pt-1 filter drop-shadow-sm">{getPlantVisual(plant.name, 2, status)}</div>
                                                <div className="pr-14">
                                                    {plant.nickname ? (
                                                        <>
                                                            <h2 className="text-xl font-bold text-slate-800 leading-tight pixel-font tracking-wide">{plant.nickname}</h2>
                                                            <p className="text-xs text-slate-500 font-bold uppercase tracking-wider">{plant.name}</p>
                                                        </>
                                                    ) : (
                                                        <h2 className="text-xl font-bold text-slate-800 leading-tight pixel-font tracking-wide">{plant.name}</h2>
                                                    )}
                                                    <div className="flex flex-wrap gap-1 mt-2">
                                                        <span className="bg-slate-100 text-slate-600 text-[10px] px-2 py-0.5 rounded-sm border border-slate-200 font-bold uppercase pixel-font truncate max-w-[100px]">{plant.containerMaterial}</span>
                                                        <span className="bg-slate-100 text-slate-600 text-[10px] px-2 py-0.5 rounded-sm border border-slate-200 font-bold uppercase pixel-font truncate max-w-[100px]">{plant.containerSize}</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div className="grid grid-cols-2 gap-2">
                                                <div className={`p-2.5 rounded-lg border-2 flex flex-col justify-between ${water.isDue ? 'bg-blue-50 border-blue-300' : 'bg-slate-50 border-slate-200'}`}>
                                                    <div className="flex justify-between items-center mb-1">
                                                        <span className="text-[10px] font-black uppercase text-blue-600 pixel-font tracking-wider">Water</span>
                                                        {water.isDue && <div className="w-2 h-2 rounded-sm bg-blue-500 animate-pulse"></div>}
                                                    </div>
                                                    <div className="mb-2 pixel-font text-lg leading-none flex items-center gap-2">
                                                        {water.isDue ? <span className="text-blue-700 font-bold">DRY!</span> : <span className="text-slate-500">{water.daysLeft} days</span>}
                                                        {water.weatherIcon}
                                                    </div>
                                                    <button onClick={() => logAction(plant.id, 'water')} className="w-full bg-blue-100 hover:bg-blue-200 text-blue-800 text-xs font-bold py-1.5 rounded-sm border border-blue-300 transition-colors flex items-center justify-center gap-1 pixel-font"><Droplets size={12}/> WATERED</button>
                                                </div>
                                                <div className={`p-2.5 rounded-lg border-2 flex flex-col justify-between ${food.isDue ? 'bg-green-50 border-green-300' : 'bg-slate-50 border-slate-200'}`}>
                                                    <div className="flex justify-between items-center mb-1">
                                                        <span className="text-[10px] font-black uppercase text-green-700 pixel-font tracking-wider">Feed</span>
                                                        {food.isDue && <div className="w-2 h-2 rounded-sm bg-green-500 animate-pulse"></div>}
                                                    </div>
                                                    <div className="mb-2 pixel-font text-lg leading-none">
                                                        {food.isDue ? <span className="text-green-700 font-bold">HUNGRY!</span> : <span className="text-slate-500">{food.daysLeft} days</span>}
                                                    </div>
                                                    <button onClick={() => logAction(plant.id, 'food')} className="w-full bg-green-100 hover:bg-green-200 text-green-800 text-xs font-bold py-1.5 rounded-sm border border-green-300 transition-colors flex items-center justify-center gap-1 pixel-font"><Utensils size={12}/> FED</button>
                                                </div>
                                            </div>
                                            {plant.notes && <div className="mt-3 pt-2 border-t border-slate-200 text-xs text-slate-500 font-mono">"{plant.notes}"</div>}
                                        </div>
                                    </div>
                                );
                            })}
                        </div>

                        {uniqueWisdom.length > 0 && (
                            <div className="bg-amber-50 border-4 border-amber-200 rounded-xl p-4 card-shadow">
                                <h3 className="text-lg font-bold text-amber-800 mb-3 flex items-center gap-2 pixel-font tracking-wider"><BookOpen size={20}/> ALMANAC WISDOM</h3>
                                <div className="space-y-2 font-mono text-sm text-amber-900">
                                    {uniqueWisdom.map((item, idx) => <div key={idx} className="flex gap-2"><span className="font-bold uppercase shrink-0">[{item.name}]:</span><span>{item.tip}</span></div>)}
                                </div>
                            </div>
                        )}
                    </div>

                    {showModal && (
                        <div className="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4 backdrop-blur-sm">
                            <div className="bg-[#fdfbf7] rounded-xl w-full max-w-md overflow-hidden card-shadow border-4 border-slate-700 max-h-[90vh] flex flex-col">
                                <div className="bg-slate-800 p-4 flex justify-between items-center border-b-4 border-slate-700">
                                    <h3 className="font-bold text-xl text-slate-200 pixel-font tracking-widest">{newPlant.id ? 'EDIT POT' : 'NEW POT'}</h3>
                                    <button onClick={closeModal}><X size={24} className="text-slate-400 hover:text-white" /></button>
                                </div>
                                <div className="overflow-y-auto p-6 space-y-5">
                                    {!newPlant.id && (
                                        <div className="relative group z-30">
                                            <div className="flex items-center border-2 border-slate-300 rounded-sm p-2 bg-slate-50 focus-within:border-amber-600 transition-colors">
                                                <Search size={20} className="text-slate-400 mr-2" />
                                                <input type="text" placeholder="SEARCH ALMANAC..." className="w-full bg-transparent outline-none text-slate-800 placeholder-slate-400 font-bold pixel-font tracking-wider" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} />
                                            </div>
                                            {librarySuggestions.length > 0 && (
                                                <ul className="absolute left-0 right-0 mt-2 bg-white border-2 border-slate-700 rounded-sm shadow-xl max-h-48 overflow-y-auto library-scroll">
                                                    {librarySuggestions.map((plant, idx) => (
                                                        <li key={idx} onClick={() => selectFromLibrary(plant)} className="p-2 hover:bg-slate-100 cursor-pointer border-b border-slate-100 last:border-0">
                                                            <div className="flex items-center gap-3">
                                                                {getPlantVisual(plant.name, 1.2)}
                                                                <div>
                                                                    <div className="font-bold text-slate-800 pixel-font tracking-wide">{plant.name}</div>
                                                                    <div className="text-[10px] text-slate-500 uppercase font-bold tracking-wider font-mono">Water Base: {plant.waterFreq}d â€¢ Feed Base: {plant.fertilizerFreq}d</div>
                                                                </div>
                                                            </div>
                                                        </li>
                                                    ))}
                                                </ul>
                                            )}
                                        </div>
                                    )}
                                    <form onSubmit={handleSavePlant} className="space-y-4 font-mono text-slate-700">
                                        <div>
                                            <label className="text-[10px] font-black text-slate-500 uppercase tracking-widest pixel-font">Plant Type</label>
                                            <input type="text" required className="w-full border-b-2 border-slate-300 p-2 focus:border-amber-600 outline-none text-lg font-bold text-slate-800 bg-transparent pixel-font" value={newPlant.name} onChange={(e) => setNewPlant({...newPlant, name: e.target.value})} />
                                        </div>
                                        <div>
                                            <label className="text-[10px] font-black text-slate-500 uppercase tracking-widest pixel-font">Nickname</label>
                                            <input type="text" placeholder="e.g. 'Big Bertha'" className="w-full border-2 border-slate-300 rounded-sm p-2 mt-1 text-sm bg-slate-50 focus:bg-white focus:border-amber-600 outline-none transition-colors font-bold" value={newPlant.nickname} onChange={(e) => setNewPlant({...newPlant, nickname: e.target.value})} />
                                        </div>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className="text-[10px] font-black text-slate-500 uppercase tracking-widest pixel-font">Location</label>
                                                <input type="text" placeholder="e.g. Railing" className="w-full border-2 border-slate-300 rounded-sm p-2 mt-1 text-sm bg-slate-50 font-bold" value={newPlant.location} onChange={(e) => setNewPlant({...newPlant, location: e.target.value})} />
                                            </div>
                                            <div>
                                                <label className="text-[10px] font-black text-slate-500 uppercase tracking-widest pixel-font">Pot Material</label>
                                                <select className="w-full border-2 border-slate-300 rounded-sm p-2 mt-1 text-sm bg-slate-50 font-bold" value={newPlant.containerMaterial} onChange={(e) => handleContainerChange('containerMaterial', e.target.value)}>
                                                    {CONTAINER_MATERIALS.map((opt, idx) => <option key={idx} value={opt.label}>{opt.label}</option>)}
                                                </select>
                                            </div>
                                        </div>
                                        <div>
                                            <label className="text-[10px] font-black text-slate-500 uppercase tracking-widest pixel-font">Pot Size</label>
                                            <select className="w-full border-2 border-slate-300 rounded-sm p-2 mt-1 text-sm bg-slate-50 font-bold" value={newPlant.containerSize} onChange={(e) => handleContainerChange('containerSize', e.target.value)}>
                                                {CONTAINER_SIZES.map((opt, idx) => <option key={idx} value={opt.label}>{opt.label}</option>)}
                                            </select>
                                        </div>
                                        <div className="bg-blue-50 p-3 rounded-lg border-2 border-blue-200">
                                            <div className="flex items-center gap-2 mb-2 text-blue-800 font-bold text-xs uppercase tracking-wide pixel-font">
                                                <Droplets size={14} /> Water Schedule
                                            </div>
                                            <div className="flex gap-3 items-center">
                                                <div className="flex items-center bg-white rounded-sm border border-blue-200 px-2">
                                                    <input type="number" min="1" className="w-12 p-2 text-center font-bold text-blue-800 outline-none pixel-font text-lg" value={newPlant.waterFreq} onChange={(e) => setNewPlant({...newPlant, waterFreq: e.target.value})} />
                                                    <span className="text-xs text-blue-400 font-bold mr-2 pixel-font">DAYS</span>
                                                </div>
                                                <div className="flex-grow text-right">
                                                    <label className="text-[10px] text-blue-400 font-bold block mb-1 pixel-font">LAST WATERED</label>
                                                    <input type="date" className="border border-blue-200 rounded-sm p-1 text-xs text-blue-800 font-bold bg-white font-mono" value={newPlant.lastWatered} onChange={(e) => setNewPlant({...newPlant, lastWatered: e.target.value})} />
                                                </div>
                                            </div>
                                        </div>
                                        <div className="bg-green-50 p-3 rounded-lg border-2 border-green-200">
                                            <div className="flex items-center gap-2 mb-2 text-green-800 font-bold text-xs uppercase tracking-wide pixel-font">
                                                <Utensils size={14} /> Feed Schedule
                                            </div>
                                            <div className="flex gap-3 items-center">
                                                <div className="flex items-center bg-white rounded-sm border border-green-200 px-2">
                                                    <input type="number" min="0" className="w-12 p-2 text-center font-bold text-green-800 outline-none pixel-font text-lg" value={newPlant.fertilizerFreq} onChange={(e) => setNewPlant({...newPlant, fertilizerFreq: e.target.value})} />
                                                    <span className="text-xs text-green-500 font-bold mr-2 pixel-font">DAYS</span>
                                                </div>
                                                <div className="flex-grow text-right">
                                                    <label className="text-[10px] text-green-500 font-bold block mb-1 pixel-font">LAST FED</label>
                                                    <input type="date" className="border border-green-200 rounded-sm p-1 text-xs text-green-800 font-bold bg-white font-mono" value={newPlant.lastFertilized} onChange={(e) => setNewPlant({...newPlant, lastFertilized: e.target.value})} />
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <label className="text-[10px] font-black text-slate-500 uppercase tracking-widest pixel-font">Notes</label>
                                            <textarea className="w-full border-2 border-slate-300 rounded-sm p-2 mt-1 text-sm h-20 resize-none bg-slate-50 font-mono" value={newPlant.notes} onChange={(e) => setNewPlant({...newPlant, notes: e.target.value})}></textarea>
                                        </div>
                                        <button type="submit" className="w-full wood-btn py-3 rounded-sm text-xl pixel-font tracking-widest flex justify-center items-center gap-2">
                                            <Save size={20} /> PLANT IT!
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
